@echo off
chcp 65001 > nul
echo ===================================================
echo Настройка векторного хранилища для RuslanAI (Исправленная версия)
echo ===================================================
echo.
echo Этот скрипт устанавливает необходимые зависимости для
echo работы векторного хранилища и исправляет проблемы с кодировкой.
echo.
echo Для работы потребуется:
echo  - Python 3.8 или выше
echo  - pip
echo.
echo Начинаем установку...
echo.

:: Переходим в директорию проекта
cd /d %~dp0

:: Проверяем наличие Python
where python >nul 2>nul
if %ERRORLEVEL% NEQ 0 (
    echo [ОШИБКА] Python не найден. Пожалуйста, установите Python 3.8 или выше.
    goto :error
)

:: Запускаем скрипт установки с исправленной кодировкой
echo Запуск скрипта настройки векторного хранилища...
python scripts\setup_vector_store_fix.py
if %ERRORLEVEL% NEQ 0 (
    echo [ОШИБКА] Не удалось настроить векторное хранилище.
    goto :error
)

echo.
echo ===================================================
echo Установка успешно завершена!
echo.
echo Теперь система памяти должна работать корректно,
echo и центральный оркестратор сможет поддерживать
echo контекст диалога.
echo.
echo Пожалуйста, перезапустите API-сервер для применения изменений:
echo  - Закройте текущий запущенный API-сервер (если он запущен)
echo  - Запустите restart_direct_api.bat или direct_api.py
echo ===================================================
echo.
pause
exit /b 0

:error
echo.
echo ===================================================
echo [ОШИБКА] Установка завершилась с ошибками
echo Проверьте логи для получения дополнительной информации
echo ===================================================
echo.
pause
exit /b 1