# Тестовая среда для системы памяти RuslanAI

## Общая информация

Данная тестовая среда предназначена для объективной оценки производительности, релевантности, масштабируемости и других характеристик системы памяти RuslanAI. Она позволяет проводить тестирование как текущей реализации, так и новых версий системы памяти, включая будущую когнитивную архитектуру.

## Структура тестовой среды

```
C:/RuslanAI/test_environment/
├── data/
│   ├── memory/                   # Копия текущей памяти
│   ├── vector_store/             # Копия текущего векторного хранилища
│   └── test_data/                # Генерируемые тестовые данные
├── logs/                         # Логи тестовых запусков
├── benchmarks/                   # Скрипты бенчмарков
│   ├── results/                  # Результаты бенчмарков
│   └── scenarios/                # Тестовые сценарии
└── memory_system/               # Копия текущей системы памяти для модификаций
    ├── memory_system.py         # Текущая система памяти
    ├── vector_store.py          # Векторное хранилище
    └── memory_system_v2.py      # Заготовка для новой системы памяти
```

## Доступные инструменты

### 1. Скрипт `memory_test_environment.py`

Основной скрипт для управления тестовой средой и запуска бенчмарков.

**Возможности:**
- Создание изолированной тестовой среды с копией текущих данных
- Генерация тестовых данных различного объема
- Запуск различных сценариев тестирования
- Формирование отчетов о результатах

**Основные параметры:**
- `--create` - Создание тестовой среды
- `--generate [small|medium|large|xlarge]` - Генерация тестовых данных указанного размера
- `--run` - Запуск бенчмарков
- `--systems [current|new|both]` - Выбор тестируемых систем памяти
- `--sizes [small|medium|large|xlarge]` - Размеры тестовых данных для бенчмарков
- `--scenarios [performance|relevance|context_restoration|scalability|all]` - Сценарии тестирования

### 2. Бенчмарки в директории `benchmarks/`

- `memory_benchmark.py` - Бенчмарк производительности основных операций
- `relevance_benchmark.py` - Бенчмарк релевантности и точности поиска

### 3. Батники для быстрого запуска

- `scripts/setup_test_environment.bat` - Настройка тестовой среды
- `scripts/run_memory_benchmarks.bat` - Запуск бенчмарков с интерактивным выбором

## Доступные тесты и бенчмарки

### 1. Тест производительности

Измеряет скорость выполнения основных операций системы памяти:

- **add_memory** - добавление элементов в память
- **retrieve_by_tags** - поиск по тегам
- **retrieve_by_content** - поиск по содержимому
- **semantic_search** - семантический поиск (если доступен)
- **update_memory** - обновление элементов памяти
- **delete_memory** - удаление элементов памяти

### 2. Тест релевантности

Оценивает точность и полноту результатов поиска по различным типам запросов:

- **exact** - точное совпадение с ключевыми словами
- **partial** - частичное совпадение с фразой
- **semantic** - семантический запрос (перефразирование)
- **related** - запрос по связанным терминам

Для каждого запроса рассчитываются метрики:
- Precision (точность)
- Recall (полнота)
- F1-score (гармоническое среднее точности и полноты)

### 3. Тест восстановления контекста

Проверяет способность системы восстанавливать контекст диалогов:

- Оценивает успешность поиска диалогов по chat_id
- Измеряет полноту восстановления (все ли сообщения восстановлены)
- Оценивает скорость восстановления диалогов

### 4. Тест масштабируемости

Анализирует, как система справляется с увеличением объема данных:

- Измеряет зависимость времени выполнения операций от объема хранилища
- Оценивает использование ресурсов при различных объемах данных
- Позволяет выявить узкие места при масштабировании

## Запуск тестовой среды

### Шаг 1: Создание тестовой среды

```
python memory_test_environment.py --create
```
или запустите батник:
```
scripts/setup_test_environment.bat
```

### Шаг 2: Генерация тестовых данных

```
python memory_test_environment.py --generate small
```

Доступные размеры:
- `small` - 1 000 записей
- `medium` - 10 000 записей
- `large` - 100 000 записей
- `xlarge` - 1 000 000 записей

### Шаг 3: Запуск бенчмарков

```
python memory_test_environment.py --run --scenarios all
```

Для запуска определенного сценария:
```
python memory_test_environment.py --run --scenarios performance
```

Для тестирования с разными размерами данных:
```
python memory_test_environment.py --run --scenarios scalability --sizes small medium large
```

Для интерактивного выбора сценария используйте батник:
```
scripts/run_memory_benchmarks.bat
```

## Анализ результатов

Результаты тестов сохраняются в директории `test_environment/benchmarks/results/` в формате JSON и HTML:

- `benchmark_results_YYYYMMDD_HHMMSS.json` - полные результаты в JSON
- `benchmark_results_YYYYMMDD_HHMMSS_report.html` - отчет в формате HTML с графиками

HTML-отчет содержит:
- Таблицы с метриками производительности
- Показатели релевантности поиска
- Статистику восстановления контекста
- Анализ масштабируемости

## Использование для сравнения систем

Для сравнения текущей системы памяти с новой версией:

1. Разработайте новую версию в файле `test_environment/memory_system/memory_system_v2.py`
2. Запустите тесты для обеих систем:
   ```
   python memory_test_environment.py --run --systems both
   ```
3. Проанализируйте результаты для выявления улучшений или регрессий

## Примечания

- Тестовая среда полностью изолирована от рабочей системы и использует отдельные копии данных
- Для наиболее точных результатов рекомендуется запускать тесты на системе без активной нагрузки
- Большие тестовые наборы (large, xlarge) могут потребовать значительных ресурсов и времени для обработки